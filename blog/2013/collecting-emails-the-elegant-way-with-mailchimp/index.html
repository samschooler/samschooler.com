
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<meta name="author" content="Sam Schooler">

<meta name="description" content="I am starting on a new project called Ficte which will be a place to read and write short stories, poems, and other forms of creative writing. Plug: If you feel you would like to try out the service when it is finished, sign up to get notified here.
In order to promote Ficte, I needed a splash page with a feature list, and a form to receive emails of people who are interested. I did not really want to go write a large back-end for this, so I went to MailChimp (Disclaimer: Referral), which, to my surprise, was a free service for people who have a small amount of subscribers. I jumped on this, and went through the steps to setup a list. When I got to connecting my list with my splash page, I got a great (sarcasm) copy-and-paste form which when submitted, directed to MailChimp to confirm the subscription. This is something I did not like, so I caved on my idea of no back-end, and wrote a simple Express app (which I will use for the rest of Ficte); This is how I did it.">


<meta property="og:title" content="Collecting Emails: The Elegant Way. With MailChimp"/>
<meta property="og:site_name" content="Sam Schooler"/>

<meta name="description" content="I am starting on a new project called Ficte which will be a place to read and write short stories, poems, and other forms of creative writing. Plug: If you feel you would like to try out the service w">
<meta property="og:type" content="article">
<meta property="og:title" content="Collecting Emails: The Elegant Way. With MailChimp">
<meta property="og:url" content="https://sam.ink/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/">
<meta property="og:site_name" content="Sam Schooler">
<meta property="og:description" content="I am starting on a new project called Ficte which will be a place to read and write short stories, poems, and other forms of creative writing. Plug: If you feel you would like to try out the service w">
<meta property="og:image" content="https://sam.ink/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-skeleton.png">
<meta property="og:image" content="https://sam.ink/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-form.png">
<meta property="og:image" content="https://sam.ink/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-pretty-form.png">
<meta property="og:updated_time" content="2015-12-18T06:31:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Collecting Emails: The Elegant Way. With MailChimp">
<meta name="twitter:description" content="I am starting on a new project called Ficte which will be a place to read and write short stories, poems, and other forms of creative writing. Plug: If you feel you would like to try out the service w">
<meta name="twitter:creator" content="@samschooler">
<link rel="publisher" href="https://plus.google.com/u/0/+SamSchooler?rel=author">

<title>Collecting Emails: The Elegant Way. With MailChimp | Sam Schooler</title>

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="Sam Schooler" type="application/atom+xml">
<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-32329980-1', 'auto');
	ga('send', 'pageview');

</script>



  </head>
  <body>
    
    <header>
      <div class="blog-name-holder left">
  <h1 class="blog-name">
    <a href="/">samschooler.</a>
  </h1>
  <h1 class="blog-name-short">
    <a href="/">sam.</a>
  </h1>
</div>
<ul class="menu right">
  
    <li><a href="/about">about.</a></li>
  
    <li><a href="https://standardresume.co/SamSchooler">resume.</a></li>
  
    <li><a href="mailto:hello@sam.ink">contact.</a></li>
  
</ul>
<div class="clear"></div>

    </header>
    <div class="wrapper">
      <section class="blog-posts">
  <article class="blog-post blog-post-post">
  <div class="article-header">
  
  <div class="article-date">Aug 19 2013</div>


  <h2 class="article-title">Collecting Emails: The Elegant Way. With MailChimp</h2>

<div class="clear"></div>

</div>
<div class="article-body ">
  
    <p>I am starting on a new project called <a href="http://ficte.com" target="_blank" rel="external">Ficte</a> which will be a place to read and write short stories, poems, and other forms of creative writing. <em>Plug: If you feel you would like to try out the service when it is finished, <a href="http://ficte.com" target="_blank" rel="external">sign up to get notified here</a>.</em></p>
<p>In order to promote <a href="http://ficte.com" target="_blank" rel="external">Ficte</a>, I needed a splash page with a feature list, and a form to receive emails of people who are interested. I did not really want to go write a large back-end for this, so I went to <a href="http://eepurl.com/CEiWX" target="_blank" rel="external">MailChimp</a> (Disclaimer: Referral), which, to my surprise, was a free service for people who have a small amount of subscribers. I jumped on this, and went through the steps to setup a list. When I got to connecting my list with my splash page, I got a great <em>(sarcasm)</em> copy-and-paste form which when submitted, directed to MailChimp to confirm the subscription. This is something I did not like, so I caved on my idea of no back-end, and wrote a simple <abbr title="Node.js Framework">Express</abbr> app (which I will use for the rest of Ficte); This is how I did it.<br><a id="more"></a></p>
<h2 id="Setting_up_an_Express_app_in_Node-js"><a href="#Setting_up_an_Express_app_in_Node-js" class="headerlink" title="Setting up an Express app in Node.js"></a>Setting up an Express app in Node.js</h2><p><em><strong>I am going to assume you have <a href="http://nodejs.org/" target="_blank" rel="external">Node.js</a> and NPM installed on an Unix machine, if not go <a href="http://nodejs.org/" target="_blank" rel="external">install them</a>.</strong></em></p>
<p>First thing we do, is to get a skeleton <abbr title="Node.js Framework">Express</abbr> app up and running. This is done in terminal by first changing the directory to your working directory, then execute the Express skeleton command which will generate the file hierarchy of a basic Express app. We also needed to install the dependencies so change the directory to the skeleton, then install them with NPM.</p>
<figure class="highlight bash"><figcaption><span>Creating an Express skeleton app</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> MY_WORKING_DIRECTORY</span><br><span class="line">express express-skeleton</span><br><span class="line"><span class="built_in">cd</span> express-skeleton</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>The skeleton does a great job setting up the file hierarchy, however it bloats the files with some unnecessary code to run the example app. The example app that this code creates can be seen on <a href="http://localhost:3000/" target="_blank" rel="external">localhost:3000</a>.</p>
<figure class="highlight bash"><figcaption><span>Previewing the skeleton</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node app</span><br></pre></td></tr></table></figure>
<p>It should look something like this:</p>
<img src="/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-skeleton.png" alt="2013812-skeleton.png" title="">
<p>Now we can shutdown the node app by pressing <code>CTRL+C</code>. In order to speed up our workflow, I would suggest downloading <a href="https://github.com/remy/nodemon" target="_blank" rel="external">nodemon</a> which auto refreshes the node app. This can be done via NPM:<br><figure class="highlight bash"><figcaption><span>Installing nodemon (optional)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nodemon</span><br></pre></td></tr></table></figure></p>
<p>Once it is installed globally, we can run it, and it will auto update when it detects changes.<br><figure class="highlight bash"><figcaption><span>Installing nodemon (optional)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure></p>
<p><em>If nodemon does not run, or it cannot be found on your machine. Make sure NPM is in your path; add this snippet to your $PATH (<code>.bashrc</code> file), close and reopen terminal, and try again.</em></p>
<figure class="highlight bash"><figcaption><span>$PATH for node on OS X 10.8.4</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Node Devlopment</span></span><br><span class="line"><span class="built_in">export</span> NODE_PATH=<span class="string">"/usr/local/lib/node"</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/usr/local/bin:/usr/local/sbin:/usr/local/mysql/bin:/usr/local/share/npm/bin:<span class="variable">$PATH</span>"</span></span><br></pre></td></tr></table></figure>
<h2 id="Serving_a_HTML_page_with_Express_routes"><a href="#Serving_a_HTML_page_with_Express_routes" class="headerlink" title="Serving a HTML page with Express routes"></a>Serving a HTML page with Express routes</h2><p>Now that the administration stuff is down, we can write code! Before we do that lets figure out what our app needs to do:</p>
<ol>
<li>It needs to serve the HTML page which will hold our form</li>
<li>It needs to receive requests with the email value</li>
<li>It needs to forward the email address to MailChimp</li>
</ol>
<p>To serve the HTML page, we need to setup a route. Routes are pretty simple, but first we need to fix some things in  <code>app.js</code>. The server launch does not work well so we are replacing the line including <code>http.createServer(app)</code> until the end of the file with:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Listening on "</span> + app.get(<span class="string">'port'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>This fixes issues I had launching the app with Heroku, foreman, and nodemon.</p>
<p>Next, we can create our index page. I prefer to use <a href="https://github.com/visionmedia/jade" target="_blank" rel="external">Jade</a> for a template engine, and that is the default template engine Express uses. To create the index page, open <code>views/index.jade</code>, this will show some default code. Replace that code with this simple html form (converted to Jade):<br><figure class="highlight"><figcaption><span>index.jade</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">!!! 5</span><br><span class="line">html(lang='en-us')</span><br><span class="line">head</span><br><span class="line">    link(rel='stylesheet', type='text/css', href='stylesheets/style.css')</span><br><span class="line">    title Signup for spam.</span><br><span class="line">    script(type='text/javascript', src='javascripts/splash.js')</span><br><span class="line">body</span><br><span class="line">h1 We will spam you.</span><br><span class="line">form(action='/s', method='POST')</span><br><span class="line">  input.email-text(type='email', name='email', placeholder='sam@example.com')</span><br><span class="line">  span.email-thanks.hide Now confirm your email</span><br><span class="line">  button(type='submit').email-submit GO</span><br><span class="line">  // This is for an AJAX loading indicator</span><br><span class="line">  .floatingBarsG.hide</span><br><span class="line">      .rotateG_01.blockG</span><br><span class="line">      .rotateG_02.blockG</span><br><span class="line">      .rotateG_03.blockG</span><br><span class="line">      .rotateG_04.blockG</span><br><span class="line">      .rotateG_05.blockG</span><br><span class="line">      .rotateG_06.blockG</span><br><span class="line">      .rotateG_07.blockG</span><br><span class="line">      .rotateG_08.blockG</span><br></pre></td></tr></table></figure></p>
<p>We now have our simple form which can be seen at <a href="http://localhost:3000" target="_blank" rel="external">localhost:3000</a>.</p>
<img src="/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-form.png" alt="2013812-form.png" title="">
<p>The form is ugly right now, but with a little style in <code>public/stylesheets/style.css</code>, It can look pretty.<br><figure class="highlight css"><figcaption><span>style.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.email-text</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">border</span>:<span class="value"> none</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">outline</span>:<span class="value"> none</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">3px</span> double <span class="hexcolor">#CCC</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">2px</span> <span class="number">55px</span> <span class="number">0px</span> <span class="number">5px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">30px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">340px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">-webkit-transition</span>:<span class="value"> background-color <span class="number">250ms</span> linear</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">-moz-transition</span>:<span class="value"> background-color <span class="number">250ms</span> linear</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">-o-transition</span>:<span class="value"> background-color <span class="number">250ms</span> linear</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">-ms-transition</span>:<span class="value"> background-color <span class="number">250ms</span> linear</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">transition</span>:<span class="value"> background-color <span class="number">250ms</span> linear</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.email-submit</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">margin-left</span>:<span class="value"> -<span class="number">60px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> none</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">border</span>:<span class="value"> none</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">font-weight</span>:<span class="value"> bold</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">30px</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#999</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.email-submit</span><span class="pseudo">:hover</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="comment">/* Loader */</span></span><br><span class="line"><span class="class">.floatingBarsG</span><span class="rules">&#123;<span class="rule"><span class="attribute">position</span>:<span class="value">relative</span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">24px</span></span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">30px</span></span></span>;<span class="rule"><span class="attribute">margin-left</span>:<span class="value">-<span class="number">30px</span></span></span>;<span class="rule"><span class="attribute">display</span>:<span class="value">inline-block</span></span>;&#125;</span><span class="class">.blockG</span><span class="rules">&#123;<span class="rule"><span class="attribute">position</span>:<span class="value">absolute</span></span>;<span class="rule"><span class="attribute">background-color</span>:<span class="value"><span class="hexcolor">#fff</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">4px</span></span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">9px</span></span></span>;<span class="rule"><span class="attribute">-moz-border-radius</span>:<span class="value"><span class="number">4px</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">scale</span>(<span class="number">0.4</span>)</span></span>;<span class="rule"><span class="attribute">-moz-animation-name</span>:<span class="value">fadeG</span></span>;<span class="rule"><span class="attribute">-moz-animation-duration</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-iteration-count</span>:<span class="value">infinite</span></span>;<span class="rule"><span class="attribute">-moz-animation-direction</span>:<span class="value">linear</span></span>;<span class="rule"><span class="attribute">-webkit-border-radius</span>:<span class="value"><span class="number">4px</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">scale</span>(<span class="number">0.4</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-name</span>:<span class="value">fadeG</span></span>;<span class="rule"><span class="attribute">-webkit-animation-duration</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-webkit-animation-iteration-count</span>:<span class="value">infinite</span></span>;<span class="rule"><span class="attribute">-webkit-animation-direction</span>:<span class="value">linear</span></span>;<span class="rule"><span class="attribute">-ms-border-radius</span>:<span class="value"><span class="number">4px</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">scale</span>(<span class="number">0.4</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-name</span>:<span class="value">fadeG</span></span>;<span class="rule"><span class="attribute">-ms-animation-duration</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-ms-animation-iteration-count</span>:<span class="value">infinite</span></span>;<span class="rule"><span class="attribute">-ms-animation-direction</span>:<span class="value">linear</span></span>;<span class="rule"><span class="attribute">-o-border-radius</span>:<span class="value"><span class="number">4px</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">scale</span>(<span class="number">0.4</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-name</span>:<span class="value">fadeG</span></span>;<span class="rule"><span class="attribute">-o-animation-duration</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-o-animation-iteration-count</span>:<span class="value">infinite</span></span>;<span class="rule"><span class="attribute">-o-animation-direction</span>:<span class="value">linear</span></span>;<span class="rule"><span class="attribute">border-radius</span>:<span class="value"><span class="number">4px</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">scale</span>(<span class="number">0.4</span>)</span></span>;<span class="rule"><span class="attribute">animation-name</span>:<span class="value">fadeG</span></span>;<span class="rule"><span class="attribute">animation-duration</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">animation-iteration-count</span>:<span class="value">infinite</span></span>;<span class="rule"><span class="attribute">animation-direction</span>:<span class="value">linear</span></span>;&#125;</span><span class="class">.rotateG_01</span><span class="rules">&#123;<span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">11px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">24s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">24s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">24s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">24s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">24s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">90deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_02</span><span class="rules">&#123;<span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">4px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">32s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">32s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">32s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">32s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">32s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">45deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_03</span><span class="rules">&#123;<span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">10px</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">1px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">4s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">0deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">4s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">0deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">4s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">0deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">4s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">0deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">4s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">0deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_04</span><span class="rules">&#123;<span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">4px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">48s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">48s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">48s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">48s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">45deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">48s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">45deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_05</span><span class="rules">&#123;<span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">11px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">56s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">56s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">56s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">56s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">90deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">56s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">90deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_06</span><span class="rules">&#123;<span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">64s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">135deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_07</span><span class="rules">&#123;<span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">10px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">72s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">180deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">72s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">180deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">72s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">180deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">72s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">180deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">72s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(<span class="number">180deg</span>)</span></span>;&#125;</span><span class="class">.rotateG_08</span><span class="rules">&#123;<span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">3px</span></span></span>;<span class="rule"><span class="attribute">-moz-animation-delay</span>:<span class="value">.<span class="number">8s</span></span></span>;<span class="rule"><span class="attribute">-moz-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-webkit-animation-delay</span>:<span class="value">.<span class="number">8s</span></span></span>;<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-ms-animation-delay</span>:<span class="value">.<span class="number">8s</span></span></span>;<span class="rule"><span class="attribute">-ms-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">-o-animation-delay</span>:<span class="value">.<span class="number">8s</span></span></span>;<span class="rule"><span class="attribute">-o-transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">135deg</span>)</span></span>;<span class="rule"><span class="attribute">animation-delay</span>:<span class="value">.<span class="number">8s</span></span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">rotate</span>(-<span class="number">135deg</span>)</span></span>;&#125;</span>100%<span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"><span class="hexcolor">#FFF</span></span></span>;&#125;</span><span class="class">.hide</span><span class="rules">&#123;<span class="rule"><span class="attribute">display</span>:<span class="value">none</span></span>;&#125;</span></span><br></pre></td></tr></table></figure></p>
<img src="/blog/2013/collecting-emails-the-elegant-way-with-mailchimp/2013812-pretty-form.png" alt="2013812-pretty-form.png" title="">
<p>Currently the form does no validation, redirects to the <code>/s</code> page which does not accept requests yet.</p>
<h2 id="Accepting_requests_and_sending_data_to_MailChimp"><a href="#Accepting_requests_and_sending_data_to_MailChimp" class="headerlink" title="Accepting requests and sending data to MailChimp"></a>Accepting requests and sending data to MailChimp</h2><p>To accept requests, we need to create a GET route for <code>/s</code>. This is easy, because the skeleton already setup a users route which we can simply rename to s. Replace the line with <code>app.get(&#39;/users&#39;, user.list);</code>, with:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/s'</span>, chimp.subscribe);</span><br></pre></td></tr></table></figure></p>
<p>This will crash your node app, so lets fix that quick by including the MailChimp API file. Replace the line that has <code>, user = require(&#39;./routes/user&#39;)</code> with:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">, chimp = <span class="built_in">require</span>(<span class="string">'./routes/chimp'</span>)</span><br></pre></td></tr></table></figure><br>The node app is probably still not working, so create the file it is trying to reference: <code>routes/chimp.js</code>. This is the file we are going to be using to connect with the MailChimp API. We need to include the MailChimp API, before we can reference it, we need to download it. To do this, go into <code>package.json</code>, and add mailchimp.</p>
<figure class="highlight js"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"application-name"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"node app.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"express"</span>: <span class="string">"3.3.4"</span>,</span><br><span class="line">    <span class="string">"jade"</span>: <span class="string">"*"</span>,</span><br><span class="line">    <span class="string">"mailchimp"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Run <code>npm install</code> again. MailChimp is now in your application.</p>
<p>We need to include the API in <code>routs/chimp.js</code>, and include our API key (API keys can be found in your <a href="https://admin.mailchimp.com/account/api/" target="_blank" rel="external">account settings under extras</a>). This code below includes the MailChimp API, your API key. It creates a MailChimp instance, and checks for errors.</p>
<figure class="highlight js"><figcaption><span>chimp.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MailChimpAPI = <span class="built_in">require</span>(<span class="string">'mailchimp'</span>).MailChimpAPI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> apiKey = <span class="string">'YOUR_API_KEY'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> api = <span class="keyword">new</span> MailChimpAPI(apiKey, &#123; version : <span class="string">'2.0'</span> &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error.message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once our API is successfully included, we can write the <code>chimp.subscribe</code> function. This function is a publicly accessible function (The <code>exports</code> variable is public) that allows for a request to be sent with an email URL parameter, which is validated, and sent to MailChimp. For this code to work you need a MailChimp API key, and a List ID from a MailChimp list.</p>
<figure class="highlight js"><figcaption><span>chimp.js - subscribe function</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">exports.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.param(<span class="string">'email'</span>));</span><br><span class="line">  <span class="keyword">if</span> (req.param(<span class="string">'email'</span>)==<span class="string">""</span> || !<span class="regexp">/[a-z0-9!#$%&amp;'*+/=?^_`&#123;|&#125;~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`&#123;|&#125;~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/</span>.test(req.param(<span class="string">'email'</span>))) <span class="comment">/* ' */</span> &#123;</span><br><span class="line">    res.send(<span class="string">"error; email : '"</span>+ req.param(<span class="string">'email'</span>) + <span class="string">"';"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    api.call(<span class="string">'lists'</span>, <span class="string">'subscribe'</span>, &#123; id: <span class="string">"YOUR_LIST_ID"</span>, email: &#123; email: req.param(<span class="string">'email'</span>) &#125; &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error.message);</span><br><span class="line">        res.send(<span class="string">"error_chimp"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">        res.send(<span class="built_in">JSON</span>.stringify(data)); <span class="comment">// Do something with your data!</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This should fix the errors that made the app crash. The app works at a basic level submitting a form, verifying the email, and sending it to MailChimp. This is great, however you end up on a blank page. To fix this, we can run the request with AJAX, instead of sending the user to the actual <code>/s</code> page.</p>
<h2 id="Submitting_a_form_via_AJAX"><a href="#Submitting_a_form_via_AJAX" class="headerlink" title="Submitting a form via AJAX"></a>Submitting a form via AJAX</h2><p>AJAX forms are quite simple. however the do require a little bit of client-side javascript. We need to create <code>public/javascripts/splash.js</code>. We will write our subscribe function, which validates the submitted email (the <a href="http://www.regular-expressions.info/email.html" target="_blank" rel="external">regex</a> accepts 99.99% of valid email addresses, which is fine for the average internet user), and sends it via <code>XMLHttpRequest</code> to <code>/s</code>, which sends the email to our list on MailChimp</p>
<figure class="highlight js"><figcaption><span>splash.js - AJAX subscribe function</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">HTMLElement.prototype.removeClass = <span class="function"><span class="keyword">function</span>(<span class="params">remove</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newClassName = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">var</span> i;</span><br><span class="line">  <span class="keyword">var</span> classes = <span class="keyword">this</span>.className.split(<span class="string">" "</span>);</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; classes.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(classes[i] !== remove) &#123;</span><br><span class="line">      <span class="keyword">if</span>(i+<span class="number">1</span> == classes.length)</span><br><span class="line">        newClassName += classes[i];</span><br><span class="line">      <span class="keyword">else</span> newClassName += classes[i] + <span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.className = newClassName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">email</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> es = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"email-submit"</span>);</span><br><span class="line">  <span class="keyword">var</span> fb = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"floatingBarsG"</span>);</span><br><span class="line">  <span class="keyword">var</span> eb = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"email-text"</span>);</span><br><span class="line">  <span class="keyword">var</span> et = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"email-thanks"</span>);</span><br><span class="line">  es[<span class="number">0</span>].className += <span class="string">" hide"</span>;</span><br><span class="line">  fb[<span class="number">0</span>].removeClass(<span class="string">"hide"</span>);</span><br><span class="line">  eb[<span class="number">0</span>].removeClass(<span class="string">"error"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (email==<span class="string">""</span> || !<span class="regexp">/[a-z0-9!#$%&amp;'*+/=?^_`&#123;|&#125;~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`&#123;|&#125;~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/</span>.test(email)) <span class="comment">/* ' */</span> &#123;</span><br><span class="line"></span><br><span class="line">  fb[<span class="number">0</span>].className += <span class="string">" hide"</span>;</span><br><span class="line">  es[<span class="number">0</span>].removeClass(<span class="string">"hide"</span>);</span><br><span class="line">  eb[<span class="number">0</span>].style.backgroundColor = <span class="string">"#f4bfbf"</span>;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;eb[<span class="number">0</span>].style.backgroundColor = <span class="string">"#fff"</span>;&#125;, <span class="number">250</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">    xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      es[<span class="number">0</span>].className += <span class="string">" hide"</span>;</span><br><span class="line">      fb[<span class="number">0</span>].className += <span class="string">" hide"</span>;</span><br><span class="line">      eb[<span class="number">0</span>].className += <span class="string">" hide"</span>;</span><br><span class="line">      et[<span class="number">0</span>].removeClass(<span class="string">"hide"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> params = <span class="string">"email="</span>+email;</span><br><span class="line">  xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"s"</span>,<span class="literal">true</span>);</span><br><span class="line">  xmlhttp.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">  xmlhttp.send(params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Next, we need to call this when the form is submitted. This is done by capturing the click event of the GO button, and also capturing when the <code>Enter</code> key is pressed.</p>
<figure class="highlight js"><figcaption><span>splash.js - capturing events</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByClassName(<span class="string">"email-text"</span>)[<span class="number">0</span>].onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e.keyCode == <span class="number">13</span>) &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line">      subscribe(e.target.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">document</span>.getElementsByClassName(<span class="string">"email-submit"</span>)[<span class="number">0</span>].onclick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    subscribe(e.target.parentNode.parentNode.getElementsByClassName(<span class="string">"email-text"</span>)[<span class="number">0</span>].value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.addEventListener)&#123;</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>,init,<span class="literal">false</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">window</span>.attachEvent(<span class="string">'onload'</span>,init);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>That should pretty much do it. We now have a Node.js app which serves a form that takes emails, validates them, and submits them back to the app. The app then submits the email to MailChimp to be placed in a list.</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>A demo can be seen on <a href="http://ficte.com" target="_blank" rel="external">ficte.com</a>, my new website, a welcoming platform to read and write short literature. If you like to read or write short fiction, you can <a href="http://ficte.com" target="_blank" rel="external">signup to get notified here</a>.</p>

  
</div>

</article>

  <div class="after-post">
  <h3>Sam Schooler</h3>
</div>

</section>

      <footer></footer>

    </div>
    <script src="/js/theme.min.js"></script>

  </body>
</html>

